!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var f,e;f=this,e=function(){var f=function(){function e(a){return c.appendChild(a.dom),a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(a){a.preventDefault(),u(++l%c.children.length)},!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));return u(0),{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();if(h.update(c-k,200),g+1e3<c&&(r.update(1e3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}};return f.Panel=function(e,f,l){var c=1/0,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r,q.height=h,q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=l,b.fillRect(0,0,r,h),b.fillStyle=f,b.fillText(e,t,v),b.fillRect(d,m,n,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d,m,n,p),{dom:q,update:function(h,w){c=Math.min(c,h),k=Math.max(k,h),b.fillStyle=l,b.globalAlpha=1,b.fillRect(0,0,r,m),b.fillStyle=f,b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v),b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p),b.fillRect(d+n-a,m,a,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}},f},"object"==typeof exports&&void 0!==module?module.exports=e():"function"==typeof define&&define.amd?define(e):f.Stats=e()},{}],2:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _require=require("../../src/bobecs"),ECS=_require.ECS,Component=_require.Component,System=_require.System,Stats=require("stats.js"),canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),stats=new Stats,xPanel=stats.addPanel(new Stats.Panel("Entities","#ff8","#221"));function randMinMax(){var min=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,max=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100;return Math.floor(Math.random()*(max-min+1)+min)}stats.showPanel(3),document.body.appendChild(stats.dom),document.body.appendChild(stats.domElement);var Position=function(_Component){function Position(x,y){_classCallCheck(this,Position);var _this=_possibleConstructorReturn(this,(Position.__proto__||Object.getPrototypeOf(Position)).call(this));return _this.x=x,_this.y=y,_this}return _inherits(Position,Component),Position}(),Velocity=function(_Component2){function Velocity(x,y){_classCallCheck(this,Velocity);var _this2=_possibleConstructorReturn(this,(Velocity.__proto__||Object.getPrototypeOf(Velocity)).call(this));return _this2.x=x,_this2.y=y,_this2}return _inherits(Velocity,Component),Velocity}(),Size=function(_Component3){function Size(w,h){_classCallCheck(this,Size);var _this3=_possibleConstructorReturn(this,(Size.__proto__||Object.getPrototypeOf(Size)).call(this));return _this3.w=w,_this3.h=h,_this3}return _inherits(Size,Component),Size}(),Color=function(_Component4){function Color(){var color=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,Color);var _this4=_possibleConstructorReturn(this,(Color.__proto__||Object.getPrototypeOf(Color)).call(this));if(!color){color="#";for(var i=0;i<6;i++)color+="0123456789ABCDEF"[randMinMax(0,15)]}return _this4.color=color,_this4}return _inherits(Color,Component),Color}(),MoveSystem=function(_System){function MoveSystem(){return _classCallCheck(this,MoveSystem),_possibleConstructorReturn(this,(MoveSystem.__proto__||Object.getPrototypeOf(MoveSystem)).apply(this,arguments))}return _inherits(MoveSystem,System),_createClass(MoveSystem,[{key:"update",value:function(entity,deltaTime){var pos=entity.get("position"),vel=entity.get("velocity");pos.x+=vel.x*deltaTime,pos.y+=vel.y*deltaTime}}]),MoveSystem}(),OutSystem=function(_System2){function OutSystem(){return _classCallCheck(this,OutSystem),_possibleConstructorReturn(this,(OutSystem.__proto__||Object.getPrototypeOf(OutSystem)).apply(this,arguments))}return _inherits(OutSystem,System),_createClass(OutSystem,[{key:"update",value:function(entity,deltaTime){var pos=entity.get("position"),size=entity.get("size");(500<pos.x+size.w||500<pos.y+size.h||pos.x<0||pos.y<0)&&(entity.remove(),ECS.createEntity().addComponent(new Position(200,200)).addComponent(new Color).addComponent(new Size(randMinMax(0,100),randMinMax(0,100))).addComponent(new Velocity(randMinMax(-500,500),randMinMax(-500,500))).addToSystem("MoveSystem").addToSystem("OutSystem").addToSystem("RenderSystem"))}}]),OutSystem}(),RenderSystem=function(_System3){function RenderSystem(canvas,ctx){_classCallCheck(this,RenderSystem);var _this7=_possibleConstructorReturn(this,(RenderSystem.__proto__||Object.getPrototypeOf(RenderSystem)).call(this));return _this7.canvas=canvas,_this7.ctx=ctx,_this7}return _inherits(RenderSystem,System),_createClass(RenderSystem,[{key:"preUpdate",value:function(deltaTime){this.canvas.width=this.canvas.width}},{key:"update",value:function(e,deltaTime){this.ctx.fillStyle=e.getComponent("color").color,this.ctx.fillRect(e.getComponent("position").x,e.getComponent("position").y,e.getComponent("size").w,e.getComponent("size").h)}}]),RenderSystem}();ECS.addSystem(new MoveSystem),ECS.addSystem(new OutSystem),ECS.addSystem(new RenderSystem(canvas,ctx));for(var i=0;i<1e3;i++)ECS.createEntity().addComponent(new Position(200,200)).addComponent(new Color).addComponent(new Size(randMinMax(0,100),randMinMax(0,100))).addComponent(new Velocity(randMinMax(-500,500),randMinMax(-500,500))).addToSystem("MoveSystem").addToSystem("OutSystem").addToSystem("RenderSystem");var oldTime=0;!function gameLoop(){var time=performance.now()/1e3,ElapsedTime=time-oldTime;stats.begin(),ECS.update(ElapsedTime),stats.end(),xPanel.update(ECS.entities().size,1200),oldTime=time,requestAnimationFrame(gameLoop)}()},{"../../src/bobecs":8,"stats.js":1}],3:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Component=function(){function Component(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Component),this._dirty=!0}return _createClass(Component,[{key:"setDirty",value:function(){var dirty=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._dirty=dirty}},{key:"isDirty",value:function(){return this._dirty}},{key:"serialize",value:function(){var _this=this,s={};return Object.getOwnPropertyNames(this).forEach(function(key){"_dirty"!==key&&(s[key]=_this[key])}),s}},{key:"build",value:function(data){Object.assign(this,data)}},{key:"clone",value:function(){var obj=Object.create(this);return this.constructor.apply(obj),obj.build(this.serialize()),obj}}]),Component}();module.exports=Component},{}],4:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var componentfactory=function(){function ComponentFactory(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ComponentFactory)}return _createClass(ComponentFactory,null,[{key:"components",value:function(){return this._components||(this._components=new Map),this._components}},{key:"add",value:function(component){this.components().set(component.name.toLowerCase(),component)}},{key:"create",value:function(componentName){if(!this.components().has(componentName.toLowerCase()))throw new Error('"'+componentName+'" is not declared in the ComponentFactory');return new(this.components().get(componentName.toLowerCase()))}}]),ComponentFactory}();module.exports=componentfactory},{}],5:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Entity=require("./Entity"),ECS=function(){function ECS(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ECS)}return _createClass(ECS,null,[{key:"entities",value:function(){return this._entities||(this._entities=new Map),this._entities}},{key:"entity",value:function(id){return this._entities||(this._entities=new Map),this._entities.get(id)}},{key:"systems",value:function(){return this._systems||(this._systems=new Map),this._systems}},{key:"system",value:function(name){return this._systems||(this._systems=new Map),this._systems.get(name.toLowerCase())}},{key:"createEntity",value:function(){var id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,entity=new Entity(id);return entity.setManager(this),this.entities().set(entity._id,entity),entity}},{key:"removeEntity",value:function(entity){var id=entity instanceof Entity?entity._id:entity;this.removeEntityFromAllSystems(entity instanceof Entity?entity:this.entity(id)),this.entities().delete(id)}},{key:"addSystem",value:function(system){var name=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.systems().set((name||system.constructor.name).toLowerCase(),system)}},{key:"removeSystem",value:function(name){this.systems().delete(name.toLowerCase())}},{key:"hasSystem",value:function(name){return this.systems().has(name.toLowerCase())}},{key:"update",value:function(){var deltaTime=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.systems().forEach(function(s){return s.updateAll(deltaTime)})}},{key:"addEntityToSystem",value:function(entity,systemName){if(!ECS.hasSystem(systemName))throw new Error("Tried to add entity to unexisting system "+systemName);this.system(systemName.toLowerCase()).addEntity(entity)}},{key:"removeEntityFromSystem",value:function(entity,systemName){if(!ECS.hasSystem(systemName))throw new Error("Tried to remove entity from unexisting system "+systemName);this.system(systemName.toLowerCase()).removeEntity(entity)}},{key:"removeEntityFromAllSystems",value:function(entity){this.systems().forEach(function(s){return s.removeEntity(entity)})}}]),ECS}();module.exports=ECS},{"./Entity":6}],6:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ComponentFactory=require("./ComponentFactory");module.exports=function(){function Entity(){var id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Entity),this._id=null===id?(+new Date).toString(16)+(1e8*Math.random()|0).toString(16)+Entity.count():id,this._tags=[],this._manager=null,this._components={}}return _createClass(Entity,[{key:"setManager",value:function(manager){this._manager=manager}},{key:"addComponent",value:function(component){return component._dirty=!0,this._components[component.constructor.name.toLowerCase()]=component,this}},{key:"removeComponent",value:function(componentName){return delete this._components[componentName.toLowerCase()],this}},{key:"hasComponent",value:function(componentName){return this._components.hasOwnProperty(componentName.toLowerCase())}},{key:"getComponent",value:function(componentName){if(!this.hasComponent(componentName))throw new Error('Tried to get unexisting component "'+componentName+'" in entity '+this._id);return this._components[componentName.toLowerCase()]}},{key:"addTag",value:function(tag){return this._tags.push(tag),this}},{key:"removeTag",value:function(tag){var index=this._tags.indexOf(tag);return~index&&this._tags.splice(index,1),this}},{key:"hasTag",value:function(tag){return-1<this._tags.indexOf(tag)}},{key:"remove",value:function(){this._manager.removeEntity(this)}},{key:"addToSystem",value:function(systemName){return this._manager.addEntityToSystem(this,systemName),this}},{key:"get",value:function(componentName){return this.getComponent(componentName)}},{key:"add",value:function(component){return this.addComponent(component)}},{key:"has",value:function(componentName){return this.hasComponent(componentName)}},{key:"serialize",value:function(){var _this=this,obj={_tags:this._tags,_components:{}};return Object.keys(this._components).forEach(function(key){obj._components[key]=_this._components[key].serialize()}),obj}},{key:"build",value:function(data){var _this2=this;Object.assign(this._tags,data._tags),Object.keys(data._components).forEach(function(key){_this2._components[key]=ComponentFactory.create(key),_this2._components[key].build(data._components[key])})}},{key:"clone",value:function(){var e=this._manager.createEntity();return e.build(this.serialize()),e}}],[{key:"count",value:function(){return this._count||(this._count=0),this._count=this._count+1,this._count}}]),Entity}()},{"./ComponentFactory":4}],7:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var System=function(){function System(){var frequency=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,System),this._frequency=frequency,this._deltaTime=0,this._entities=[]}return _createClass(System,[{key:"addEntity",value:function(entity){this._entities.push(entity),this.postAdd(entity)}},{key:"removeEntity",value:function(entity){var index=this._entities.indexOf(entity);~index&&(this._entities.splice(index,1),this.postRemove(entity))}},{key:"updateAll",value:function(deltaTime){if(this._deltaTime+=deltaTime,this._deltaTime>=this._frequency){this.preUpdate(this._deltaTime);for(var i=0;i<this._entities.length;i+=1)this.update(this._entities[i],this._deltaTime);this.postUpdate(this._deltaTime),this._deltaTime=0}}},{key:"update",value:function(entity,deltaTime){}},{key:"preUpdate",value:function(deltaTime){}},{key:"postUpdate",value:function(deltaTime){}},{key:"postAdd",value:function(entity){}},{key:"postRemove",value:function(entity){}}]),System}();module.exports=System},{}],8:[function(require,module,exports){"use strict";var Entity=require("./Entity"),Component=require("./Component"),ECS=require("./ECS"),System=require("./System"),ComponentFactory=require("./ComponentFactory");module.exports={ECS:ECS,Entity:Entity,Component:Component,System:System,ComponentFactory:ComponentFactory}},{"./Component":3,"./ComponentFactory":4,"./ECS":5,"./Entity":6,"./System":7}]},{},[2]);