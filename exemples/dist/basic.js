!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_bobecs=require("../../lib/bobecs"),_stats=require("stats.js"),_stats2=(obj=_stats)&&obj.__esModule?obj:{default:obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),stats=new _stats2.default,xPanel=stats.addPanel(new _stats2.default.Panel("Entities","#ff8","#221"));function randMinMax(){var min=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,max=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100;return Math.floor(Math.random()*(max-min+1)+min)}stats.showPanel(3),document.body.appendChild(stats.dom),document.body.appendChild(stats.domElement);var Position=function(_Component){function Position(x,y){_classCallCheck(this,Position);var _this=_possibleConstructorReturn(this,(Position.__proto__||Object.getPrototypeOf(Position)).call(this));return _this.x=x,_this.y=y,_this}return _inherits(Position,_bobecs.Component),Position}(),Velocity=function(_Component2){function Velocity(x,y){_classCallCheck(this,Velocity);var _this2=_possibleConstructorReturn(this,(Velocity.__proto__||Object.getPrototypeOf(Velocity)).call(this));return _this2.x=x,_this2.y=y,_this2}return _inherits(Velocity,_bobecs.Component),Velocity}(),Size=function(_Component3){function Size(w,h){_classCallCheck(this,Size);var _this3=_possibleConstructorReturn(this,(Size.__proto__||Object.getPrototypeOf(Size)).call(this));return _this3.w=w,_this3.h=h,_this3}return _inherits(Size,_bobecs.Component),Size}(),Color=function(_Component4){function Color(){var color=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,Color);var _this4=_possibleConstructorReturn(this,(Color.__proto__||Object.getPrototypeOf(Color)).call(this));if(!color){color="#";for(var i=0;i<6;i++)color+="0123456789ABCDEF"[randMinMax(0,16)]}return _this4.color=color,_this4}return _inherits(Color,_bobecs.Component),Color}(),MoveSystem=function(_System){function MoveSystem(){return _classCallCheck(this,MoveSystem),_possibleConstructorReturn(this,(MoveSystem.__proto__||Object.getPrototypeOf(MoveSystem)).apply(this,arguments))}return _inherits(MoveSystem,_bobecs.System),_createClass(MoveSystem,[{key:"update",value:function(entity,deltaTime){var pos=entity.get("position"),vel=entity.get("velocity");pos.x+=vel.x*deltaTime,pos.y+=vel.y*deltaTime}}]),MoveSystem}(),OutSystem=function(_System2){function OutSystem(){return _classCallCheck(this,OutSystem),_possibleConstructorReturn(this,(OutSystem.__proto__||Object.getPrototypeOf(OutSystem)).apply(this,arguments))}return _inherits(OutSystem,_bobecs.System),_createClass(OutSystem,[{key:"update",value:function(entity,deltaTime){var pos=entity.get("position"),size=entity.get("size");(500<pos.x+size.w||500<pos.y+size.h||pos.x<0||pos.y<0)&&(entity.remove(),_bobecs.ECS.createEntity().addComponent(new Position(200,200)).addComponent(new Color).addComponent(new Size(randMinMax(0,100),randMinMax(0,100))).addComponent(new Velocity(randMinMax(-500,500),randMinMax(-500,500))).addToSystem("MoveSystem").addToSystem("OutSystem").addToSystem("RenderSystem"))}}]),OutSystem}(),RenderSystem=function(_System3){function RenderSystem(canvas,ctx){_classCallCheck(this,RenderSystem);var _this7=_possibleConstructorReturn(this,(RenderSystem.__proto__||Object.getPrototypeOf(RenderSystem)).call(this));return _this7.canvas=canvas,_this7.ctx=ctx,_this7}return _inherits(RenderSystem,_bobecs.System),_createClass(RenderSystem,[{key:"preUpdate",value:function(deltaTime){this.canvas.width=this.canvas.width}},{key:"update",value:function(e,deltaTime){this.ctx.fillStyle=e.getComponent("color").color,this.ctx.fillRect(e.getComponent("position").x,e.getComponent("position").y,e.getComponent("size").w,e.getComponent("size").h)}}]),RenderSystem}();_bobecs.ECS.addSystem(new MoveSystem),_bobecs.ECS.addSystem(new OutSystem),_bobecs.ECS.addSystem(new RenderSystem(canvas,ctx));for(var i=0;i<1e3;i++)_bobecs.ECS.createEntity().addComponent(new Position(200,200)).addComponent(new Color).addComponent(new Size(randMinMax(0,100),randMinMax(0,100))).addComponent(new Velocity(randMinMax(-500,500),randMinMax(-500,500))).addToSystem("MoveSystem").addToSystem("OutSystem").addToSystem("RenderSystem");var oldTime=0;!function gameLoop(){var time=performance.now()/1e3,ElapsedTime=time-oldTime;stats.begin(),_bobecs.ECS.update(ElapsedTime),stats.end(),xPanel.update(_bobecs.ECS._entities.length,1200),oldTime=time,requestAnimationFrame(gameLoop)}()},{"../../lib/bobecs":6,"stats.js":7}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Component=function(){function Component(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Component),this._dirty=!0}return _createClass(Component,[{key:"setDirty",value:function(){var dirty=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._dirty=dirty}},{key:"isDirty",value:function(){return this._dirty}}]),Component}();exports.default=Component},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Entity=require("./Entity"),_Entity2=(obj=_Entity)&&obj.__esModule?obj:{default:obj};var ECS=function(){function ECS(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ECS)}return _createClass(ECS,null,[{key:"createEntity",value:function(){var id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,entity=new _Entity2.default(id);return entity.setManager(this),ECS._entities.push(entity),entity}},{key:"removeEntity",value:function(entity){var index=this._entities.indexOf(entity);if(!~index)throw new Error("Tried to remove entity not in list");this.removeEntityFromAllSystems(entity),this._entities.splice(index,1)}},{key:"addSystem",value:function(system){ECS._systems[system.constructor.name.toLowerCase()]=system}},{key:"removeSystem",value:function(systemName){delete ECS._systems[systemName.toLowerCase()]}},{key:"hasSystem",value:function(systemName){return ECS._systems.hasOwnProperty(systemName.toLowerCase())}},{key:"update",value:function(){var deltaTime=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;for(var systemName in ECS._systems)ECS._systems.hasOwnProperty(systemName)&&ECS._systems[systemName].updateAll(deltaTime)}},{key:"addEntityToSystem",value:function(entity,systemName){if(!ECS.hasSystem(systemName))throw new Error("Tried to add entity to unexisting system "+systemName);ECS._systems[systemName.toLowerCase()].addEntity(entity)}},{key:"removeEntityFromSystem",value:function(entity,systemName){if(!ECS.hasSystem(systemName))throw new Error("Tried to remove entity from unexisting system "+systemName);ECS._systems[systemName.toLowerCase()].removeEntity(entity)}},{key:"removeEntityFromAllSystems",value:function(entity){for(var systemName in ECS._systems)ECS._systems.hasOwnProperty(systemName)&&this.removeEntityFromSystem(entity,systemName)}}]),ECS}();ECS._entities=[],ECS._systems={},exports.default=ECS},{"./Entity":4}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var Entity=function(){function Entity(){var id=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Entity),this._id=null===id?(+new Date).toString(16)+(1e8*Math.random()|0).toString(16)+Entity.count():id,this._tags=[],this._manager=null,this._components={}}return _createClass(Entity,[{key:"setManager",value:function(manager){this._manager=manager}},{key:"addComponent",value:function(component){return component._dirty=!0,this._components[component.constructor.name.toLowerCase()]=component,this}},{key:"removeComponent",value:function(componentName){return delete this._components[componentName.toLowerCase()],this}},{key:"hasComponent",value:function(componentName){return this._components.hasOwnProperty(componentName.toLowerCase())}},{key:"getComponent",value:function(componentName){if(!this.hasComponent(componentName))throw new Error("Tried to get unexisting component in entity "+this._id);return this._components[componentName.toLowerCase()]}},{key:"addTag",value:function(tag){return this._tags.push(tag),this}},{key:"removeTag",value:function(tag){var index=this._tags.indexOf(tag);return~index&&this._tags.splice(index,1),this}},{key:"hasTag",value:function(tag){return-1<this._tags.indexOf(tag)}},{key:"remove",value:function(){this._manager.removeEntity(this)}},{key:"addToSystem",value:function(systemName){return this._manager.addEntityToSystem(this,systemName),this}},{key:"get",value:function(componentName){return this.getComponent(componentName)}},{key:"add",value:function(component){return this.addComponent(component)}},{key:"has",value:function(componentName){return this.hasComponent(componentName)}}],[{key:"count",value:function(){return this._count||(this._count=0),this._count=this._count+1,this._count}}]),Entity}();exports.default=Entity},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var System=function(){function System(){var frequency=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,System),this._frequency=frequency,this._deltaTime=0,this._entities=[]}return _createClass(System,[{key:"addEntity",value:function(entity){this._entities.push(entity),this.postAdd(entity)}},{key:"removeEntity",value:function(entity){var index=this._entities.indexOf(entity);~index&&(this._entities.splice(index,1),this.postRemove(entity))}},{key:"updateAll",value:function(deltaTime){if(this._deltaTime+=deltaTime,this._deltaTime>=this._frequency){this.preUpdate(this._deltaTime);for(var i=0;i<this._entities.length;i+=1)this.update(this._entities[i],this._deltaTime);this.postUpdate(this._deltaTime),this._deltaTime=0}}},{key:"update",value:function(entity,deltaTime){}},{key:"preUpdate",value:function(deltaTime){}},{key:"postUpdate",value:function(deltaTime){}},{key:"postAdd",value:function(entity){}},{key:"postRemove",value:function(entity){}}]),System}();exports.default=System},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.System=exports.Component=exports.Entity=exports.ECS=void 0;var _Entity2=_interopRequireDefault(require("./Entity")),_Component2=_interopRequireDefault(require("./Component")),_ECS2=_interopRequireDefault(require("./ECS")),_System2=_interopRequireDefault(require("./System"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.ECS=_ECS2.default,exports.Entity=_Entity2.default,exports.Component=_Component2.default,exports.System=_System2.default},{"./Component":2,"./ECS":3,"./Entity":4,"./System":5}],7:[function(require,module,exports){var f,e;f=this,e=function(){var f=function(){function e(a){return c.appendChild(a.dom),a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(a){a.preventDefault(),u(++l%c.children.length)},!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));return u(0),{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();if(h.update(c-k,200),g+1e3<c&&(r.update(1e3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}};return f.Panel=function(e,f,l){var c=1/0,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r,q.height=h,q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=l,b.fillRect(0,0,r,h),b.fillStyle=f,b.fillText(e,t,v),b.fillRect(d,m,n,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d,m,n,p),{dom:q,update:function(h,w){c=Math.min(c,h),k=Math.max(k,h),b.fillStyle=l,b.globalAlpha=1,b.fillRect(0,0,r,m),b.fillStyle=f,b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v),b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p),b.fillRect(d+n-a,m,a,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}},f},"object"==typeof exports&&void 0!==module?module.exports=e():"function"==typeof define&&define.amd?define(e):f.Stats=e()},{}]},{},[1]);